<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://kit.fontawesome.com/4a5535eb48.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <link rel="stylesheet" href="style.css">
     <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
          <span class="navbar-item" href="https://bulma.io">
            <h1><span class="is-size-1">UrDay</span></h1>
            <i class="fas fa-thermometer-half fa-3x"></i>
            <p class="is-size-3 rainorshine">Rain or shine... it's UrDay!</p>
          </span>
      
          <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div> 
          <div class="navbar-end">
            <div class="navbar-item">
              <div class="buttons">
                <a class="button is-primary">
                  <strong>Sign up</strong>
                </a>
                <a class="button is-light">
                  Log in
                </a>
              </div>
            </div>
          </div>
        </div>
      </nav>
    <div class="columns">

        <div id ="searchqueries" class="column is-one-quarter small-side">
            <div class="box">
                <p><strong>Which city?</strong></p>
                <input id="searchbar" class="input" placeholder="Ex: New York City, NY">
                <button id="searchbutton" class="button is-primary">Search</button>
            </div>
            <box class="errorbox box hide">Error: City not valid or UV index not available</box>



        </div>

        <div class="column is-three-quarters wide-side">
          <box class="box"><h1><strong>Current Weather:</strong></h1>
            <box class="box is-paddingless">
                <h1 id="currentCity" class="is-size-3">Welcome! Search to get started!</h1><br>
                <p id="currentTemp" class="is-size-1 currentDetails"></p><br>
                <p id="currentHumid" class="currentDetails"></p><br>
                <p id="currentWind" class="currentDetails"></p><br>
                <p id="currentUV" class="currentDetails"></p><br><br> 
            </box>
            </box>
          <box class="box"><h1 class ="is-full clearfix"><div><strong>Five-Day Forecast:</strong></h1>
            <div class="tile is-ancestor is-gapless">
                <div class="tile is-2 box five">
                  Day one:
                </div>
                <div class="tile is-2 box five">
                Day two:
                </div>
                <div class="tile is-2 box five">
                    Day three:
                </div>
                <div class="tile is-2 box five">
                    Day four:
                    </div>
                    <div class="tile is-2 box five">
                    Day five:
                        </div>
              </div>

        </box>
        </div>
    </div>
</body>
</html>

<script>
    // Error message 
    $(document).ajaxError(function() {
    $(".errorbox").removeClass("hide");
    });
    
    // On Click  function to initiate search
    $("#searchbutton").click(function(){
    
    // Empty contents of past search 
    $("#currentCity").empty();   
    $("#currentUV").empty();
    $("#currentTemp").empty();
    $("#currentHumid").empty();
    $("#currentWind").empty();

    // Get rid of error message if Ajax worked
    $(".errorbox").addClass("hide");

    // Storing data for Ajax call
    var userInput = $("#searchbar").val();
    var APIKey = "02daff08193d9225a26eb2edb0d88351";
    var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + userInput + "&appid=" + APIKey;
    console.log(userInput);
    
    // Creating Bulma box for each past search query
    const newBox = $("<box>").attr("class","box");
    const queryList = $("#searchqueries");
    queryList.append(newBox.text(userInput));
    

    // Ajax call for Weather API
    $.ajax({
        method: "GET",
        url: queryURL
    }).then(function(response) {
        console.log(response);

        
        // Storing relevant data from response
        const currentCityName = response.name + " ("+ moment().format('MM/D/YYYY') + ")";
        const currentHumid = "Humidity: " + response.main.humidity + "%";
        const currentWind = "Wind Speed: " + (response.wind.speed * 2.23694).toFixed(2) +  " mph";
        const currentTemp = (response.main.temp * 9/5 - 459.67).toFixed(0) + "Â°F";

        // Grab elements to display current city info
        $("#currentTemp").text(currentTemp);
        $("#currentCity").text(currentCityName);
        $("#currentHumid").text(currentHumid);
        $("#currentWind").text(currentWind);

        // Storying data for UV Ajax call
        const currentLat = response.coord.lon;
        const currentLong = response.coord.lat;
        const UVquery = "http://api.openweathermap.org/data/2.5/uvi?lat=" + currentLat + "&lon=" + currentLong + "&appid=" + APIKey;

        // Ajax call for current UV index
        $.ajax({
            method: "GET",
            url: UVquery
        }).then(function(responseUV) {

            console.log(responseUV);
            // Store UVindex
            const uvIndex = "UV index: " + responseUV.value;

            // Display UV index
            $("#currentUV").text(uvIndex);

            // Query for 5 day Forecast
            const fiveQuery = "http://api.openweathermap.org/data/2.5/forecast?lat=" + currentLat + "&lon=" + currentLong + "&appid=" + APIKey;

            $.ajax({
                method: "GET",
                url: fiveQuery
            }).then(function(responseFive) {
                console.log(responseFive);
            });
        });

        
    })});


 



</script>

